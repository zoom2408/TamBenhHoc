<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Thi Tâm Bệnh Học</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .question-container {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .question-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 pb-28">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-indigo-500 sticky top-0 z-10">
        <div class="max-w-4xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center">
                BÀI THI TÂM BỆNH HỌC
            </h1>
            <p class="text-center text-gray-600 mt-2 text-lg">
                40 câu hỏi • Mỗi câu 0.25 điểm
            </p>
            <div class="text-center mt-3 text-sm text-indigo-600">
                20 câu kiến thức + 20 câu ca lâm sàng (4 ca × 5 câu)
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8">
        <!-- PHẦN I: KIẾN THỨC -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-indigo-700 mb-6 border-b-2 border-indigo-200 pb-3">
                PHẦN I: KIẾN THỨC (20 câu)
            </h2>
            <!-- Câu hỏi kiến thức sẽ được tạo bởi JavaScript -->
            <div id="knowledge-questions"></div>
        </section>

        <!-- PHẦN II: CA LÂM SÀNG -->
        <section class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-indigo-700 mb-6 border-b-2 border-indigo-200 pb-3">
                PHẦN II: CA LÂM SÀNG (20 câu)
            </h2>
            <!-- Ca lâm sàng sẽ được tạo bởi JavaScript -->
            <div id="clinical-cases"></div>
        </section>

        <!-- Results Summary -->
        <div id="results" class="bg-gradient-to-r from-green-500 to-blue-600 text-white rounded-lg p-6 mt-8" style="display: none;">
            <h2 class="text-2xl font-bold mb-4 text-center">KẾT QUẢ BÀI THI</h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="text-center bg-white/20 p-4 rounded-lg">
                    <div id="score-number" class="text-4xl font-bold">0/40</div>
                    <div class="text-sm mt-1">Số câu đúng</div>
                </div>
                <div class="text-center bg-white/20 p-4 rounded-lg">
                    <div id="percentage" class="text-4xl font-bold">0%</div>
                    <div class="text-sm mt-1">Tỷ lệ chính xác</div>
                </div>
                <div class="text-center bg-white/20 p-4 rounded-lg">
                    <div id="grade" class="text-4xl font-bold">0.0</div>
                    <div class="text-sm mt-1">Điểm (thang 10)</div>
                </div>
            </div>
            <div class="mt-6 text-center">
                <span id="evaluation" class="inline-block px-6 py-2 rounded-full text-lg font-bold">
                    CHƯA ĐÁNH GIÁ
                </span>
            </div>
        </div>
    </main>

    <!-- Sticky Bottom Buttons -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm shadow-lg border-t p-4">
        <div class="max-w-4xl mx-auto flex justify-center space-x-4">
            <button id="submit-btn" onclick="handleSubmit()"
                 class="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                Nộp bài
            </button>
            <button onclick="handleReset()"
                 class="px-8 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                Làm lại
            </button>
        </div>
    </footer>

    <script>
        // --- DATA ---
        // Using 'const' for data that doesn't change
        const knowledgeQuestions = [
            { id: 1, question: "Theo tiếp cận sinh học, rối loạn khí sắc chủ yếu liên quan đến sự mất cân bằng của những chất dẫn truyền thần kinh nào?", options: ["A. Dopamine và GABA", "B. Serotonin và norepinephrine", "C. Acetylcholine và glutamate", "D. Oxytocin và vasopressin"], correct: "B", explanation: "Serotonin và norepinephrine là hai chất dẫn truyền thần kinh chính liên quan đến rối loạn khí sắc như trầm cảm và lưỡng cực." },
            { id: 2, question: "Trong lý thuyết cấu trúc nhân cách của Bergeret, cấu trúc nhân cách nào có lo hãi chủ đạo là 'bị thiến'?", options: ["A. Loạn tâm", "B. Nhiễu tâm", "C. Lệch lạc", "D. Ranh giới"], correct: "B", explanation: "Cấu trúc nhiễu tâm có lo hãi chủ đạo là 'bị thiến' theo giai đoạn Oedipus trong lý thuyết phân tâm." },
            { id: 3, question: "Mô hình A-B-C của Albert Ellis trong tiếp cận nhận thức được hiểu như thế nào?", options: ["A. A = Antecedent, B = Behavior, C = Consequence", "B. A = Sự kiện kích hoạt, B = Quá trình nhận thức, C = Hành vi/cảm xúc", "C. A = Anxiety, B = Belief, C = Coping", "D. A = Assessment, B = Baseline, C = Change"], correct: "B", explanation: "Mô hình A-B-C của Ellis: A (Activating event - Sự kiện kích hoạt), B (Belief - Quá trình nhận thức), C (Consequence - Hành vi/cảm xúc)." },
            { id: 4, question: "Theo DSM-5, chẩn đoán Tâm thần phân liệt yêu cầu triệu chứng phải kéo dài ít nhất:", options: ["A. 1 tháng", "B. 3 tháng", "C. 6 tháng", "D. 1 năm"], correct: "C", explanation: "DSM-5 yêu cầu các dấu hiệu rối loạn liên tục tồn tại ít nhất 6 tháng để chẩn đoán Tâm thần phân liệt." },
            { id: 5, question: "Triệu chứng nào sau đây KHÔNG phải là triệu chứng dương tính trong tâm thần phân liệt?", options: ["A. Ảo giác", "B. Hoang tưởng", "C. Giảm biểu lộ cảm xúc", "D. Suy nghĩ vô tổ chức"], correct: "C", explanation: "Giảm biểu lộ cảm xúc là triệu chứng âm tính. Triệu chứng dương tính bao gồm ảo giác, hoang tưởng, suy nghĩ vô tổ chức." },
            { id: 6, question: "Theo DSM-5, pha hưng cảm trong Rối loạn Lưỡng cực I phải kéo dài ít nhất:", options: ["A. 2 ngày", "B. 4 ngày", "C. 1 tuần", "D. 2 tuần"], correct: "C", explanation: "Pha hưng cảm phải kéo dài ≥1 tuần hoặc bất kỳ thời gian nào nếu cần nhập viện. Hưng cảm nhẹ chỉ cần ≥4 ngày." },
            { id: 7, question: "Điểm khác biệt chính giữa Rối loạn Lưỡng cực I và II là:", options: ["A. Độ tuổi khởi phát", "B. Có hay không có pha hưng cảm toàn phát", "C. Mức độ trầm cảm", "D. Khả năng di truyền"], correct: "B", explanation: "Lưỡng cực I có ít nhất một pha hưng cảm toàn phát, trong khi Lưỡng cực II chỉ có hưng cảm nhẹ." },
            { id: 8, question: "Theo nghiên cứu, tỷ lệ bệnh nhân rối loạn lưỡng cực có hành vi tự sát ít nhất 1 lần trong đời là:", options: ["A. 10-15%", "B. 20-25%", "C. 25-50%", "D. 60-70%"], correct: "C", explanation: "25-50% bệnh nhân rối loạn lưỡng cực có hành vi tự sát, 15% 'thành công'. Đây là tỷ lệ rất cao." },
            { id: 9, question: "Theo DSM-5, chẩn đoán Trầm cảm chủ yếu yêu cầu:", options: ["A. ≥3/9 triệu chứng trong ≥1 tuần", "B. ≥4/9 triệu chứng trong ≥2 tuần", "C. ≥5/9 triệu chứng trong ≥2 tuần", "D. ≥6/9 triệu chứng trong ≥1 tháng"], correct: "C", explanation: "DSM-5 yêu cầu ≥5/9 triệu chứng trong ≥2 tuần, phải có khí sắc trầm hoặc mất hứng thú." },
            { id: 10, question: "Tiêu chuẩn nào bắt buộc phải có ≥1 để chẩn đoán giai đoạn trầm cảm chủ yếu?", options: ["A. Thay đổi cân nặng", "B. Khí sắc trầm hoặc mất hứng thú", "C. Mất ngủ/Ngủ nhiều", "D. Cảm giác vô dụng/tội lỗi"], correct: "B", explanation: "DSM-5 yêu cầu phải có ít nhất một trong hai triệu chứng cốt lõi: khí sắc trầm lan tỏa hoặc mất hứng thú." },
            { id: 11, question: "Rối loạn lo âu lan tỏa (GAD) yêu cầu lo lắng khó kiểm soát kéo dài ít nhất:", options: ["A. 3 tháng", "B. 6 tháng", "C. 9 tháng", "D. 1 năm"], correct: "B", explanation: "GAD yêu cầu lo lắng lan tỏa khó kiểm soát kéo dài ≥6 tháng kèm ≥3/6 triệu chứng thể chất." },
            { id: 12, question: "Khái niệm 'siêu lo lắng' (meta-worry) trong GAD theo Wells (1995) là:", options: ["A. Lo lắng về sức khỏe", "B. Lo lắng về việc mình không thể hết lo lắng", "C. Lo lắng về công việc", "D. Lo lắng về tiền bạc"], correct: "B", explanation: "Siêu lo lắng là lo lắng về chính việc lo lắng của mình (worry about worry), đặc trưng của GAD." },
            { id: 13, question: "Khác biệt khái niệm 'sợ' và 'lo' ở cấp mạng lưới não:", options: ["A. Sợ liên quan hạch hạnh nhân; Lo liên quan BNST", "B. Cả hai không liên quan não", "C. Đều do dopaminergic", "D. Sợ = vỏ trán; Lo = tiểu não"], correct: "A", explanation: "'Sợ' cấp tính liên quan amygdala, 'lo' kéo dài/không chắc chắn liên quan BNST (bed nucleus of stria terminalis)." },
            { id: 14, question: "Đặc trưng trung tâm của rối loạn lo âu xã hội:", options: ["A. Sợ bị đánh giá tiêu cực trong tình huống xã hội/biểu hiện", "B. Sợ không gian kín", "C. Sợ máu", "D. Sợ bệnh"], correct: "A", explanation: "Lo âu xã hội có đặc trưng là sợ bị đánh giá tiêu cực bởi người khác trong các tình huống xã hội." },
            { id: 15, question: "Đặc trưng cốt lõi của agoraphobia là sợ:", options: ["A. Nơi đông người", "B. Nơi khó thoát/khó được trợ giúp kịp thời", "C. Nơi tối", "D. Nơi cao"], correct: "B", explanation: "Agoraphobia đặc trưng bởi nỗi sợ các tình huống khó thoát ra hoặc khó có được sự trợ giúp khi cần thiết." },
            { id: 16, question: "Theo DSM-5, chẩn đoán Rối loạn Ám ảnh Cưỡng chế yêu cầu các triệu chứng phải:", options: ["A. Xuất hiện ít nhất 3 lần/tuần", "B. Chiếm >1 giờ/ngày hoặc gây suy giảm chức năng đáng kể", "C. Kéo dài ít nhất 6 tháng", "D. Không đáp ứng với thuốc"], correct: "B", explanation: "DSM-5 yêu cầu ám ảnh hoặc cưỡng chế mất >1 giờ/ngày hoặc gây phiền muộn/suy giảm chức năng đáng kể." },
            { id: 17, question: "'Thổi phồng trách nhiệm' trong OCD được thể hiện như thế nào?", options: ["A. Cảm thấy có trách nhiệm ngăn chặn điều xấu xảy ra", "B. Muốn làm lãnh đạo", "C. Thích chỉ trích người khác", "D. Không muốn nhận trách nhiệm"], correct: "A", explanation: "Thổi phồng trách nhiệm là việc BN OCD cảm thấy có trách nhiệm quá mức trong việc ngăn ngừa hậu quả tiêu cực." },
            { id: 18, question: "Mối quan hệ điển hình giữa ám ảnh và cưỡng chế trong OCD:", options: ["A. Không liên quan gì nhau", "B. Cưỡng chế được thực hiện để giảm lo âu từ ám ảnh", "C. Ám ảnh xuất hiện sau cưỡng chế", "D. Chỉ có một trong hai"], correct: "B", explanation: "75% BN có cả ám ảnh và cưỡng chế. Cưỡng chế thường được thực hiện để giảm lo âu từ ám ảnh, tạo vòng luẩn quẩn." },
            { id: 19, question: "Liệu pháp ERP (Exposure and Response Prevention) trong OCD bao gồm:", options: ["A. Chỉ dùng thuốc", "B. Tiếp xúc dần với kích thích gây sợ + ngăn chặn hành vi cưỡng chế", "C. Chỉ tư vấn tâm lý", "D. Chỉ thôi miên"], correct: "B", explanation: "ERP kết hợp phơi nhiễm với kích thích gây lo âu và ngăn chặn phản ứng cưỡng chế cho đến khi lo âu tự nhiên giảm." },
            { id: 20, question: "Trong phổ OCD và các rối loạn liên quan, có bao nhiêu rối loạn chính được phân loại?", options: ["A. 7 rối loạn", "B. 8 rối loạn", "C. 9 rối loạn", "D. 10 rối loạn"], correct: "C", explanation: "DSM-5 phân loại 9 rối loạn trong nhóm OCD và các RL liên quan, bao gồm OCD, BDD, hoarding, trichotillomania, v.v." }
        ];

        const clinicalCases = [
            {
                caseId: "CA1",
                title: "CA 1 - Nam 28 tuổi, hoang tưởng và ảo thanh 8 tháng",
                sections: [
                    { title: "(1) Trình bày bệnh", content: "Anh L., 28 tuổi, nhân viên IT, vào khám vì 8 tháng nay tin rằng đồng nghiệp 'theo dõi và âm mưu hại mình'. Anh nghe thấy tiếng nói bình luận hành động của mình, thỉnh thoảng ra lệnh. Suy nghĩ rối loạn, khó theo dõi mạch tư duy. Không quan tâm vệ sinh cá nhân, sụt cân 7kg." },
                    { title: "(2) Tiền sử - bối cảnh", content: "Không tiền sử tâm thần. Bố có tiền sử 'tâm thần' chưa rõ chẩn đoán. Không sử dụng chất. Khởi phát âm ỉ từ sau khi thăng chức, áp lực công việc tăng." },
                    { title: "(3) Khám cận lâm sàng", content: "Khám nội tổng quát bình thường. Xét nghiệm máu, chức năng gan thận, TSH trong giới hạn bình thường. Test sàng lọc chất gây nghiện âm tính." },
                    { title: "(4) Khám tâm thần", content: "Hợp tác từng lúc, nghi ngờ mục đích thăm khám. Hoang tưởng bị hại có hệ thống. Ảo thanh bình luận và ra lệnh. Tư duy rời rạc, thiếu mạch lạc logic. Cảm xúc cùn mòn. Không ý thức bệnh." }
                ],
                questions: [
                    { id: 21, question: "Chẩn đoán phù hợp nhất cho trường hợp này?", options: ["A. Rối loạn cảm xúc phân liệt", "B. Tâm thần phân liệt", "C. Rối loạn dạng phân liệt", "D. Trầm cảm có loạn thần"], correct: "B", explanation: "Có ≥2/5 triệu chứng (hoang tưởng, ảo giác, tư duy rời rạc, triệu chứng âm tính) trong >1 tháng, suy giảm chức năng, kéo dài 8 tháng → Tâm thần phân liệt." },
                    { id: 22, question: "Tiêu chuẩn thời gian nào đã được đáp ứng trong ca này?", options: ["A. ≥1 tháng các triệu chứng giai đoạn hoạt động", "B. ≥6 tháng các dấu hiệu rối loạn liên tục", "C. Cả A và B", "D. Không đáp ứng tiêu chuẩn thời gian"], correct: "C", explanation: "Ca này có triệu chứng hoạt động >1 tháng và tổng thời gian rối loạn 8 tháng, đáp ứng cả tiêu chuẩn A (≥1 tháng) và C (≥6 tháng) của DSM-5." },
                    { id: 23, question: "Triệu chứng âm tính được thể hiện qua:", options: ["A. Hoang tưởng bị hại", "B. Ảo thanh bình luận", "C. Cảm xúc cùn mòn, không quan tâm vệ sinh", "D. Tư duy rời rạc"], correct: "C", explanation: "Cảm xúc cùn mòn và không quan tâm vệ sinh cá nhân là triệu chứng âm tính. Các triệu chứng khác đều là triệu chứng dương tính." },
                    { id: 24, question: "Yếu tố nguy cơ di truyền trong ca này:", options: ["A. Không có yếu tố di truyền", "B. Bố có tiền sử 'tâm thần'", "C. Áp lực công việc", "D. Tuổi tác 28"], correct: "B", explanation: "Tiền sử gia đình có người mắc rối loạn tâm thần (bố) là yếu tố nguy cơ di truyền quan trọng cho tâm thần phân liệt." },
                    { id: 25, question: "Điều trị ưu tiên đầu tiên cho ca này:", options: ["A. Chỉ tâm lý trị liệu", "B. Thuốc chống loạn thần thế hệ mới (atypical antipsychotics)", "C. Chỉ thuốc chống trầm cảm", "D. Điện co giật"], correct: "B", explanation: "Thuốc chống loạn thần là điều trị hàng đầu cho tâm thần phân liệt, ưu tiên thuốc thế hệ mới do ít tác dụng phụ hơn." }
                ]
            }
            // You can add more clinical cases here in the same format
        ];

        // --- STATE ---
        // Using 'let' for variables that will be reassigned
        let userAnswers = {};
        let isSubmitted = false;
        
        // --- Combine all questions into one array for easier processing ---
        const allQuestions = [
            ...knowledgeQuestions,
            ...clinicalCases.flatMap(caseItem => caseItem.questions)
        ];

        // --- RENDER FUNCTIONS ---
        
        /**
         * Generic function to render a list of questions
         * @param {Array} questions - The array of question objects to render.
         * @param {HTMLElement} container - The DOM element to append the questions to.
         */
        function renderQuestionList(questions, container) {
            let html = '';
            questions.forEach((question, index) => {
                html += `
                <div class="mb-6 p-4 border border-gray-200 rounded-lg question-container">
                    <h3 class="font-semibold text-gray-800 mb-3">
                        Câu ${question.id}: ${question.question}
                    </h3>
                    <div class="space-y-2">
                        ${question.options.map(option => `
                            <label class="flex items-start space-x-3 cursor-pointer hover:bg-indigo-50 p-2 rounded transition-colors">
                                <input type="radio" name="question-${question.id}" value="${option.charAt(0)}"
                                       onchange="handleAnswerChange(${question.id}, '${option.charAt(0)}')"
                                       class="mt-1 w-4 h-4 text-indigo-600 focus:ring-indigo-500 border-gray-300" />
                                <span class="text-gray-700">${option}</span>
                            </label>
                        `).join('')}
                    </div>
                    <div id="result-${question.id}" class="mt-4 p-3 bg-gray-50 rounded border-l-4" style="display: none;">
                        <div class="flex items-center space-x-3 mb-2">
                            <span id="status-${question.id}" class="inline-flex items-center px-2 py-1 rounded text-sm font-medium"></span>
                            <span class="text-sm text-gray-600">
                                Đáp án đúng: <strong>${question.correct}</strong>
                            </span>
                        </div>
                        <p class="text-sm text-gray-700 italic">${question.explanation}</p>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        /**
         * Function to render clinical cases
         * This function renders the case description and its associated questions.
         */
        function renderClinicalCases() {
            const container = document.getElementById('clinical-cases');
            let html = '';
            clinicalCases.forEach(caseItem => {
                html += `
                <div class="mb-8 p-5 bg-indigo-50 border border-indigo-200 rounded-lg">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">${caseItem.title}</h3>
                    <div class="space-y-3 text-gray-700">
                        ${caseItem.sections.map(section => `
                            <p><strong>${section.title}:</strong> ${section.content}</p>
                        `).join('')}
                    </div>
                </div>`;
                // Render questions for this case
                let questionHtml = '';
                caseItem.questions.forEach(question => {
                    questionHtml += `
                    <div class="mb-6 p-4 border border-gray-200 rounded-lg question-container">
                        <h3 class="font-semibold text-gray-800 mb-3">
                            Câu ${question.id}: ${question.question}
                        </h3>
                        <div class="space-y-2">
                            ${question.options.map(option => `
                                <label class="flex items-start space-x-3 cursor-pointer hover:bg-indigo-50 p-2 rounded transition-colors">
                                    <input type="radio" name="question-${question.id}" value="${option.charAt(0)}"
                                           onchange="handleAnswerChange(${question.id}, '${option.charAt(0)}')"
                                           class="mt-1 w-4 h-4 text-indigo-600 focus:ring-indigo-500 border-gray-300" />
                                    <span class="text-gray-700">${option}</span>
                                </label>
                            `).join('')}
                        </div>
                        <div id="result-${question.id}" class="mt-4 p-3 bg-gray-50 rounded border-l-4" style="display: none;">
                           <div class="flex items-center space-x-3 mb-2">
                                <span id="status-${question.id}" class="inline-flex items-center px-2 py-1 rounded text-sm font-medium"></span>
                                <span class="text-sm text-gray-600">
                                    Đáp án đúng: <strong>${question.correct}</strong>
                                </span>
                            </div>
                            <p class="text-sm text-gray-700 italic">${question.explanation}</p>
                        </div>
                    </div>`;
                });
                html += questionHtml;
            });
            container.innerHTML = html;
        }

        // --- EVENT HANDLERS ---
        function handleAnswerChange(questionId, answer) {
            if (isSubmitted) return; // Prevent changing answers after submission
            userAnswers[questionId] = answer;
        }

        function handleSubmit() {
            if (isSubmitted) return;
            
            let correctCount = 0;
            allQuestions.forEach(q => {
                if (userAnswers[q.id] === q.correct) {
                    correctCount++;
                }
            });

            isSubmitted = true;
            displayResults(correctCount);

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.className = 'px-8 py-3 bg-gray-400 text-white font-semibold rounded-lg cursor-not-allowed';
            submitBtn.textContent = 'Đã nộp bài';

            // Disable all radio buttons
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.disabled = true;
            });
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function displayResults(score) {
            const totalQuestions = allQuestions.length;
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.classList.add('fade-in');

            document.getElementById('score-number').textContent = `${score}/${totalQuestions}`;
            document.getElementById('percentage').textContent = ((score / totalQuestions) * 100).toFixed(1) + '%';
            // --- UPDATE: Calculate grade based on 0.25 points per question ---
            document.getElementById('grade').textContent = (score * 0.25).toFixed(2);

            const evaluationEl = document.getElementById('evaluation');
            const percentage = (score / totalQuestions) * 100;
            if (percentage >= 80) {
                evaluationEl.textContent = 'XUẤT SẮC';
                evaluationEl.className = 'inline-block px-6 py-2 rounded-full text-lg font-bold bg-green-600 text-white';
            } else if (percentage >= 50) {
                evaluationEl.textContent = 'ĐẠT';
                evaluationEl.className = 'inline-block px-6 py-2 rounded-full text-lg font-bold bg-yellow-500 text-white';
            } else {
                evaluationEl.textContent = 'CHƯA ĐẠT';
                evaluationEl.className = 'inline-block px-6 py-2 rounded-full text-lg font-bold bg-red-600 text-white';
            }

            allQuestions.forEach(q => {
                const resultEl = document.getElementById(`result-${q.id}`);
                const statusEl = document.getElementById(`status-${q.id}`);
                
                if (resultEl && statusEl) {
                    resultEl.style.display = 'block';
                    resultEl.classList.add('fade-in');
                    
                    const isCorrect = userAnswers[q.id] === q.correct;
                    if (isCorrect) {
                        statusEl.textContent = '✓ Đúng';
                        statusEl.className = 'inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-green-100 text-green-800';
                        resultEl.classList.add('border-green-500');
                    } else {
                        statusEl.textContent = '✗ Sai';
                        statusEl.className = 'inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-red-100 text-red-800';
                        resultEl.classList.add('border-red-500');
                    }
                }
            });
        }

        function handleReset() {
            userAnswers = {};
            isSubmitted = false;

            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
                radio.disabled = false;
            });

            document.getElementById('results').style.display = 'none';

            document.querySelectorAll('[id^="result-"]').forEach(el => {
                el.style.display = 'none';
            });

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = false;
            submitBtn.className = 'px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5';
            submitBtn.textContent = 'Nộp bài';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            // Render knowledge questions
            const knowledgeContainer = document.getElementById('knowledge-questions');
            renderQuestionList(knowledgeQuestions, knowledgeContainer);

            // Render clinical cases
            renderClinicalCases();
        };
    </script>
</body>
</html>
